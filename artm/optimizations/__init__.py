"""
Denotation:
    s_dw = sum_t phi_tw * theta_dt
    A_dw = n_dw / s_dw
    B_dw = n_dw / f_d, where f_d either sum_w n_dw or sum_w [n_dw > 0]
"""